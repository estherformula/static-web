<!-- https://estherformula.github.io/static-web/app_starter.html?deeplink=estherpack://store -->

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•±ìœ¼ë¡œ ì´ë™</title>

    <!-- Open Graph ë©”íƒ€ íƒœê·¸ (ì¹´í†¡, í˜ì´ìŠ¤ë¶ ë“± ê³µìœ ì‹œ í‘œì‹œ) -->
    <meta property="og:title" content="ì•± ì´ë¦„">
    <meta property="og:description" content="ì•±ì—ì„œ í™•ì¸í•˜ì„¸ìš”!">
    <meta property="og:image" content="https://your-domain.com/app-icon.png">

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .container {
            text-align: center;
            padding: 20px;
            max-width: 400px;
        }

        .loading {
            font-size: 24px;
            margin-bottom: 20px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .manual-links {
            margin-top: 30px;
            opacity: 0;
            animation: fadeIn 1s forwards;
            animation-delay: 2s;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .store-button {
            display: inline-block;
            margin: 10px;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: transform 0.2s;
            cursor: pointer;
            border: none;
            font-size: 16px;
        }

        .store-button:hover {
            transform: scale(1.05);
        }

        .debug-info {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
            text-align: left;
            font-family: 'Courier New', monospace;
        }

        .test-notice {
            background: rgba(255,255,255,0.2);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .status {
            font-size: 14px;
            margin-top: 10px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="loading">ì•±ìœ¼ë¡œ ì´ë™ ì¤‘...</div>
    <div class="spinner"></div>
    <div class="status" id="status">ì•± ì‹¤í–‰ì„ ì‹œë„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>

    <!-- í…ŒìŠ¤íŠ¸ ì•ˆë‚´ ë©”ì‹œì§€ -->
<!--    <div class="test-notice">-->
<!--        <p>âš ï¸ í˜„ì¬ ìë™ ì‹¤í–‰ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤</p>-->
<!--        <p style="font-size: 14px;">ì‹¤ì œ ì‚¬ìš©ì‹œ 138ë²ˆì§¸ ì¤„ ì£¼ì„ì„ í•´ì œí•˜ì„¸ìš”</p>-->
<!--    </div>-->

    <!-- ìˆ˜ë™ ë§í¬ -->
    <div class="manual-links">
        <p>ìˆ˜ë™ í…ŒìŠ¤íŠ¸:</p>
        <button onclick="executeDeepLink()" class="store-button" style="background: #4CAF50; color: white;">
            ğŸš€ ì•± ì‹¤í–‰í•˜ê¸°
        </button>
        <br><br>
        <p>ë˜ëŠ” ìŠ¤í† ì–´ë¡œ ì§ì ‘ ì´ë™:</p>
        <a href="#" onclick="goToStore(); return false;" class="store-button" id="store-link">
            ğŸª ì•± ìŠ¤í† ì–´ë¡œ ì´ë™
        </a>
    </div>

    <!-- ë””ë²„ê·¸ ì •ë³´ -->
    <div class="debug-info" id="debug-info"></div>
</div>

<script>
    // âš ï¸ ì•„ë˜ ì„¤ì •ì„ ì‹¤ì œ ì•± ì •ë³´ë¡œ ë³€ê²½í•˜ì„¸ìš”!
    const CONFIG = {
        // ë”¥ë§í¬ ì„¤ì •
        deepLink: 'estherpack://',  // ì•± Custom Scheme URL

        // ì•± ìŠ¤í† ì–´ URL
        appStores: {
            ios: 'https://apps.apple.com/app/id6737678222',  // iOS ì•± ìŠ¤í† ì–´ URL
            android: 'https://play.google.com/store/apps/details?id=com.estherformula.estherpack.android',  // ì•ˆë“œë¡œì´ë“œ í”Œë ˆì´ìŠ¤í† ì–´ URL
            fallback: 'https://esthermall.co.kr'  // ë‘˜ ë‹¤ ì•„ë‹ ê²½ìš° (ë°ìŠ¤í¬í†± ë“±) ì´ë™í•  URL
        },

        // íƒ€ì´ë° ì„¤ì • (ë°€ë¦¬ì´ˆ)
        waitTime: 2500,  // ì•± ì‹¤í–‰ ëŒ€ê¸° ì‹œê°„ (2.5ì´ˆ)
        delayBeforeExecute: 100  // í˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰ ëŒ€ê¸° ì‹œê°„
    };

    // ==========================================
    // ğŸ”´ ìë™ ì‹¤í–‰ ì½”ë“œ - ì‹¤ì œ ì‚¬ìš©ì‹œ ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ì„¸ìš”!
    // ==========================================

    setTimeout(executeDeepLink, CONFIG.delayBeforeExecute);  // ğŸ‘ˆ ì´ ì¤„ì˜ ì£¼ì„(//)ì„ ì œê±°í•˜ë©´ ìë™ ì‹¤í–‰ë©ë‹ˆë‹¤

    // ==========================================
    // ğŸ”´ ìë™ ì‹¤í–‰ ì½”ë“œ ë
    // ==========================================

    // OS ê°ì§€
    function detectOS() {
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;

        if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
            return 'ios';
        }

        if (/android/i.test(userAgent)) {
            return 'android';
        }

        return 'other';
    }

    // ì•± ìŠ¤í† ì–´ë¡œ ì´ë™
    function goToStore() {
        const os = detectOS();
        let storeUrl;

        switch(os) {
            case 'ios':
                storeUrl = CONFIG.appStores.ios;
                break;
            case 'android':
                storeUrl = CONFIG.appStores.android;
                break;
            default:
                storeUrl = CONFIG.appStores.fallback;
        }

        updateStatus('ì•± ìŠ¤í† ì–´ë¡œ ì´ë™í•©ë‹ˆë‹¤...');
        window.location.href = storeUrl;
    }

    // ë”¥ë§í¬ ì‹¤í–‰ (ì•± ì‹¤í–‰ ì‹œë„)
    function executeDeepLink() {
        const startTime = Date.now();

        updateStatus('ì•± ì‹¤í–‰ì„ ì‹œë„í•©ë‹ˆë‹¤...');

        // ë”¥ë§í¬ ì‹¤í–‰ ì‹œë„
        // iframe ë°©ì‹ (iOS/Android ëª¨ë‘ ì§€ì›)
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = CONFIG.deepLink;
        document.body.appendChild(iframe);

        // ëŒ€ì²´ ë°©ë²•: location.href (ì¼ë¶€ í™˜ê²½ì—ì„œ ë” ì˜ ì‘ë™)
        setTimeout(() => {
            window.location.href = CONFIG.deepLink;
        }, 100);

        // ì•±ì´ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
        let appOpened = false;
        const checkInterval = setInterval(() => {
            if (document.hidden || document.webkitHidden) {
                // í˜ì´ì§€ê°€ ë°±ê·¸ë¼ìš´ë“œë¡œ ê°”ë‹¤ë©´ ì•±ì´ ì‹¤í–‰ëœ ê²ƒ
                appOpened = true;
                clearInterval(checkInterval);
                clearTimeout(fallbackTimeout);
                updateStatus('ì•±ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }, 200);

        // ì¼ì • ì‹œê°„ í›„ì—ë„ ì•±ì´ ì—´ë¦¬ì§€ ì•Šìœ¼ë©´ ìŠ¤í† ì–´ë¡œ ì´ë™
        const fallbackTimeout = setTimeout(() => {
            clearInterval(checkInterval);
            if (!appOpened && !document.hidden) {
                updateStatus('ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìŠ¤í† ì–´ë¡œ ì´ë™í•©ë‹ˆë‹¤...');
                setTimeout(goToStore, 500);
            }
        }, CONFIG.waitTime);

        // í˜ì´ì§€ í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸ ê°ì§€ (ë” ì •í™•í•œ ê°ì§€)
        window.addEventListener('blur', () => {
            appOpened = true;
            clearInterval(checkInterval);
            clearTimeout(fallbackTimeout);
        });

        // iOS Safariì˜ ê²½ìš° ì¶”ê°€ ê°ì§€
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                appOpened = true;
                clearInterval(checkInterval);
                clearTimeout(fallbackTimeout);
            }
        });
    }

    // ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
    function updateStatus(message) {
        const statusEl = document.getElementById('status');
        if (statusEl) {
            statusEl.textContent = message;
        }
        console.log(message);
    }

    // URL íŒŒë¼ë¯¸í„° ì²˜ë¦¬ (ë™ì  ë”¥ë§í¬ìš©)
    function processUrlParams() {
        const params = new URLSearchParams(window.location.search);

        const couponCode = params.get('coupon');
        if (couponCode) {
            CONFIG.deepLink = `estherpack://my/myCoupon?couponCode=${couponCode}`;
            console.log(`deeplink = coupon, code = ${couponCode}`)
            return
        }

        // ì˜ˆ: ?goodsId=5678 -> myapp://goods/5678
        const goodsId = urlParams.get('goodsId');
        if (goodsId) {
            CONFIG.deepLink = `estherpack://store/goods?goodsId=${goodsId}`;
            console.log(`deeplink = goods, code = ${goodsId}`)
            return
        }

        // ìº í˜ì¸ íŒŒë¼ë¯¸í„° ì²˜ë¦¬
        const campaign = urlParams.get('campaign');
        if (campaign) {
            // ë”¥ë§í¬ì— ìº í˜ì¸ ì •ë³´ ì¶”ê°€
            CONFIG.deepLink += `?campaign=${campaign}`;
            console.log(`deeplink = campaign, code = ${campaign}`)
            return
        }
        console.log(`deeplink = null`)
    }

    // ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ
    function showDebugInfo() {
        const debugEl = document.getElementById('debug-info');
        const os = detectOS();

        debugEl.innerHTML = `
                <strong>ğŸ” ë””ë²„ê·¸ ì •ë³´:</strong><br>
                <strong>OS:</strong> ${os}<br>
                <strong>User Agent:</strong> ${navigator.userAgent.substring(0, 80)}...<br>
                <strong>ë”¥ë§í¬:</strong> ${CONFIG.deepLink}<br>
                <strong>iOS ìŠ¤í† ì–´:</strong> ${CONFIG.appStores.ios}<br>
                <strong>Android ìŠ¤í† ì–´:</strong> ${CONFIG.appStores.android}<br>
                <strong>ëŒ€ê¸° ì‹œê°„:</strong> ${CONFIG.waitTime}ms
            `;
    }

    // ì´ˆê¸°í™”
    window.addEventListener('DOMContentLoaded', () => {
        processUrlParams();
        showDebugInfo();
    });
</script>
</body>
</html>
