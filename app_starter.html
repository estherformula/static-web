<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>에스더팩</title>

    <meta property="og:title" content="에스더팩" />
    <meta property="og:description" content="앱 다운로드 하러가기" />
    <meta property="og:image" content="https://ik.imagekit.io/estherpack/img_starter.jpg" />

    <style>
        /* 1. 기본 스타일 리셋 */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            min-height: 100%;
            background-color: #f8f8f8; /* 이미지 로드 전 배경색 */
        }

        /* 2. 배경 이미지 설정: 가로 100% 맞춤 & 세로 길이에 따라 스크롤 생성 */
        .bg-container {
            width: 100%;
            display: block;
        }

        .bg-container img {
            width: 100%;
            height: auto;
            display: block; /* 하단 빈공간 방지 */
            margin-bottom: 100px; /* 버튼 공간 확보 */
        }

        /* 3. 앱 다운로드 버튼: 화면 하단 고정 */
        .fixed-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 16px;
            box-sizing: border-box; /* 패딩 포함 너비 계산 */
            background: linear-gradient(to top, rgba(255,255,255,1) 70%, rgba(255,255,255,0)); /* 버튼 뒤 살짝 가려지게 */
            z-index: 1000;
        }

        .store-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 500px; /* 모바일 가독성 상한선 */
            height: 56px;
            margin: 0 auto;
            background: #000;
            color: #fff;
            text-decoration: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            /* 아이폰 하단 홈바(Safe Area) 대응 */
            margin-bottom: env(safe-area-inset-bottom);
        }

        /* 디버그 정보 (필요시 확인용, 평소엔 숨김) */
        .debug-info {
            position: absolute;
            top: 0;
            left: 0;
            background: rgba(0,0,0,0.5);
            color: white;
            font-size: 10px;
            pointer-events: none;
            display: none; /* 디버깅 시 block으로 변경 */
        }
    </style>
</head>
<body>

    <div class="bg-container">
        <img src="https://ik.imagekit.io/estherpack/img_starter_0130.jpg" alt="배경 이미지">
    </div>

    <div class="fixed-footer">
        <a href="#" onclick="goToStore(); return false;" class="store-button" id="store-link">
            앱 다운로드
        </a>
    </div>

    <div class="debug-info" id="debug-info"></div>

    <script>
        const CONFIG = {
            deepLink: "estherpack://",
            appStores: {
                ios: "https://apps.apple.com/app/id6737678222",
                android: "https://play.google.com/store/apps/details?id=com.estherformula.estherpack.android",
                fallback: "https://play.google.com/store/apps/details?id=com.estherformula.estherpack.android",
            },
            waitTime: 0,
            delayBeforeExecute: 100,
        };

        // 자동 실행이 필요하면 아래 주석을 해제하세요.
        // window.addEventListener("load", () => {
        //     setTimeout(executeDeepLink, CONFIG.delayBeforeExecute);
        // });

        function detectOS() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) return "ios";
            if (/android/i.test(userAgent)) return "android";
            return "other";
        }

        function goToStore() {
            const os = detectOS();
            let storeUrl = os === "ios" ? CONFIG.appStores.ios : (os === "android" ? CONFIG.appStores.android : CONFIG.appStores.fallback);
            window.location.href = storeUrl;
        }

        function executeDeepLink() {
            const iframe = document.createElement("iframe");
            iframe.style.display = "none";
            iframe.src = CONFIG.deepLink;
            document.body.appendChild(iframe);

            setTimeout(() => {
                window.location.href = CONFIG.deepLink;
            }, 100);

            let appOpened = false;
            const fallbackTimeout = setTimeout(() => {
                if (!appOpened && !document.hidden) {
                    goToStore();
                }
            }, CONFIG.waitTime);

            window.addEventListener("blur", () => { appOpened = true; });
            document.addEventListener("visibilitychange", () => { if (document.hidden) appOpened = true; });
        }

        function processUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const couponCode = params.get("coupon");
            const goodsId = params.get("goodsId");

            if (couponCode) {
                CONFIG.deepLink = `estherpack://my/myCoupon?couponCode=${couponCode}`;
            } else if (goodsId) {
                CONFIG.deepLink = `estherpack://store/goods?goodsId=${goodsId}`;
            }
        }

        window.addEventListener("DOMContentLoaded", () => {
            processUrlParams();
        });
    </script>
</body>
</html>